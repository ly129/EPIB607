---
title: 'A2: Histograms, Medians, Means, Boxplots and Standard Deviation'
subtitle: 'Natalee Hung 260822094'
author: 'EPIB 607, Fall 2018, McGill University'
date: '`r Sys.Date()`'
output:
  html_document:
    keep_md: no
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: no 
  pdf_document:
    toc: yes
    toc_depth: '4'
editor_options:
  chunk_output_type: console
---

```{r include = FALSE, message = FALSE}
## ---- Setup ------------------------------------------------------------------
knitr::opts_chunk$set(
  echo = FALSE,          # don't show code
  warning = FALSE,       # don't show warnings
  message = FALSE,       # don't show messages (less serious warnings)
  cache = FALSE,         # set to TRUE to save results from last compilation
  fig.align = "center",   # center figures
  fig.asp = 1,          # fig.aspect ratio
  fig.width = 10        # fig width
)

library(pacman)
library(mosaic)
library(ggplot2)
library(knitr)
library(dplyr)

```


# Age-structures of Populations, then and now

a) The earliest year of birth was 1802 for males and 1804 for females.
```{r echo = FALSE, results = 'hide'}
## ---- Question-1 (A) --------------------------------------------------------

# Opening the data 
cens <- read.csv("https://github.com/sahirbhatnagar/EPIB607/raw/master/data/age_sex_frequencies_ireland.csv") 
head(cens)

## (i) 
# New object with only males
males <- cens[cens$Gender == "Male" & cens$Freq>0,]

# New object with only age column for males
m_age <- males[,2]

# Sorting age in descending order
m_age_desc <- sort(m_age, decreasing = TRUE)

# Calculating the year of birth for oldest male in the dataset
1911-m_age_desc[1]

## (ii) 
# New object with only females
females <- cens[cens$Gender == "Female" & cens$Freq>0,]

# New object with only age column for females
f_age <- females[,2]

# Sorting age in descending order
f_age_desc <- sort(f_age, decreasing = TRUE)

# Calculating the year of birth for oldest male in the dataset
1911-f_age_desc[1]
  
```

b) From the wide base of the population pyramid in Figure 1, we can see that the majority of the population are under the age of 30, indicating a high birth rate and a youthful population. The decline in frequency for both genders occurs at around 50 years of age, reflective of the early post-industrialization life-expectancy in Ireland at the time. The population distribution is similar between both genders, with the exception when comparing people in their 20s, with a slighly higher frequency of females relative to males. 

<div style="margin-bottom:50px;">
</div>

```{r echo = FALSE, message = FALSE, fig.width=6.5, fig.height=5}
## ---- Question-1 (B) --------------------------------------------------------

# Plotting a population pyramid
# Code adapted from: https://aledemogr.com/2016/01/11/population-pyramids-in-ggplot/
ggplot(data=cens) +
geom_bar(aes(Age,Freq,group=Gender,fill=Gender), stat = "identity",subset(females,females$Gender=="Female")) +
geom_bar(aes(Age,-Freq,group=Gender,fill=Gender), stat = "identity",subset(males,males$Gender=="Male")) +
scale_y_continuous(breaks=seq(-5000,7000,1000),labels=abs(seq(-5000,7000,1000))) +
ggtitle("Figure 1. Population Distribution by Age and Sex, 
        Ireland, 1911") +
labs(x="Age",y="Frequency") +
theme(plot.title = element_text(hjust = .5), 
      axis.ticks = element_blank()) +
coord_flip()

```
<div style="margin-bottom:25px;">
</div>

(c)

<style>
.nobullet li {
  list-style-type: none;
}
</style>

<div class="nobullet">
* __Males__
</div>

* Mean: 27.21
* SD: 19.11
* Q1: 11
* Median: 24
* Q3: 40

<div class="nobullet">
* __Females__
</div>

* Mean: 29.15
* SD: 19.86
* Q1: 13
* Median: 26
* Q3: 42

```{r echo = FALSE, results = 'hide', message = FALSE}
## ---- Question-1 (C) --------------------------------------------------------

## MALES ##
# Calculating mean and standard deviation
m_mean <- sum(males$Age * males$Freq) / sum(males$Freq)
m_mean
m_sd <- sqrt(sum((males$Age - m_mean)**2 * males$Freq) / (sum(males$Freq)-1))
m_sd

# Calculating quantiles
m_rep <- rep(males$Age, males$Freq) 
quantile(m_rep, c(.25, .50, .75))

## FEMALES ##
# Calculating mean and standard deviation
f_mean <- sum(females$Age * females$Freq) / sum(females$Freq)
f_mean
f_sd <- sqrt(sum((females$Age - f_mean)**2 * females$Freq) / (sum(females$Freq)-1))
f_sd

# Calculating quantiles
f_rep <- rep(females$Age, females$Freq) 
quantile(f_rep, c(.25, .50, .75))

```
<div style="margin-bottom:25px;">
</div>

d) This census card contains information about William Sealy Gosset, a statistican who developed the t-distribution.  

<div style="margin-bottom:50px;">
</div>

# Number of Authors

a) The mean is strongly influenced by extreme observations, whereas the median is not, so it is considered a resistant measure of centre. The median number of subjects may have been used to ensure that the estimate would not be influenced by outliers in the data. 

b) The standard deviation is not restricted by the value of the mean. The standard deviation is a description of how widely the data is distributed about the mean, and a large standard deviation indicates that the data are more spread out. In 1976, the standard deviation of 7.3 can really be larger than the mean of 4.9

c) I would plot a graph with one x-axis for year and two y-axes, one for number of authors per article and one for the number of students studied in each article. For ease of explanation, the former will be the left y-axis and the latter will be the right y-axis, although they could be interchangeable in pratice. For the mean number of authors for articles, I would plot each mean as individual circular points with error bars to illustrate standard deviation according to the left y-axis. For the median number of students studied in each article, I would also plot each value as individual circular points, but in different colour. Below the graph, I would add a note to tell the reader how many articles were studied in each year as supplementary information.

<div style="margin-bottom:50px;">
</div>

# Cancer Deaths in the US

a) In the figure 'Trends in Age-adjusted Cancer Death Rates by Site, Males, US, 1930-2014', the following scales were used:

* Position (axes)
* Direction
* Colour of lines 


<div class="nobullet">
* The variables that have been mapped on to them are:
</div>

* Age-adjusted Cancer Death Rates per 100,000 male population
* Year
* Site of cancer

<div style="margin-bottom:50px;">
</div>

b) A line graph was well-chosen as a visualization approach for the data. One thing that this graph has done particularly well is in the scaling of the x and y axes so that the data is well spaced out, so the lines comparing the different sites of cancer are not crowded together. In terms of position, it is clear to compare the cancer death rates for different sites at individual time points, as well as to track general trends across the time frame displayed.

<div class="nobullet">
* However, this strength is somewhat offset by the choice of colours for the lines. Although the palette is aesthetically pleasing, some colours are too similar to be easily distinguished, for example, the different shades of grey. The choice of blue and grey would also make this graph difficult to read for some colour blind readers. The choice to label the cancer sites WITHIN the graph itself, although helpful given the unclear colour palette, could be considered distracting.
</div>

<div style="margin-bottom:50px;">
</div>

c) From Figures 2 and 3, we see that for the cancer sites that are common to both males and females, the direction of the trend lines rise and fall at similar points in time. The most striking difference is in the high death rate of lung and brochus cancer for males compared to females. For males, the death rate rose sharpely from around 1945 to 1975, reaching rates of approximately 90 per 100,000 in the mid 1980s before falling sharpely to approximately 50 per 100,000 by 2014. By contrast, the rise in death rates of lung and bronchus cancer for females was comparatively gradual, with their maximum rate appearing to be half of that of males within the measured time period. 

<div style="margin-bottom:50px;">
</div>

```{r echo FALSE, results = 'hide', message = FALSE}
## ---- Question-3 ------------------------------------------------------------

# Loading readxl package
library(readxl)

# Downloading the spreadsheets
males_q3 <- readxl::read_xlsx("~/Downloads/age-adjusted-cancer-death-rates-males-1930-2014.xlsx",
skip = 1, n_max = 85) %>% mutate(Gender = "Male")
females_q3 <- readxl::read_xlsx("~/Downloads/age-adjusted-cancer-death-rates-females-1930-2014.xlsx",
skip = 1, n_max = 85) %>% mutate(Gender = "Female") 

# Combining the datasets
cancer_rates <- dplyr::bind_rows(list(females_q3,males_q3))

head(cancer_rates)

# Loading tidyr package
library(tidyr)

# Melting the dataset
cancer_rates_melt <- tidyr::gather(cancer_rates, key = "Site", value = "Rate", -Year, -Gender)

head(cancer_rates_melt, n = 10)

```

```{r,echo=FALSE, message = FALSE}

## ---- Question-3 ------------------------------------------------------------

# Isolating data for males
males_q3_2 <- cancer_rates_melt[cancer_rates_melt$Gender == "Male" & !is.na(cancer_rates_melt$Rate),]

# Assigning colours to sites
m_q3_cols <- c("Colon and Rectum" = "#999999", "Leukemia" = "#E69F00", "Liver†" = "#56B4E9", "Lung and Bronchus" = "#009E73", "Pancreas†" = "#F0E442", "Prostate" = "#0072B2", "Stomach" = "#D55E00")

# Creating line graph for males
q3_p1 <- gf_smooth(Rate ~ Year, data = males_q3_2, color = ~Site) + 
            ylim(c(0, 90)) + 
            labs(title="Figure 2. Age-adjusted Cancer Death Rates by Site", 
                 subtitle= "Males, US, 1930-2014",
                 y = "Rate per 100,000 male population") +   
            scale_colour_manual(values = m_q3_cols)

# Isolating data for females
females_q3_2 <- cancer_rates_melt[cancer_rates_melt$Gender == "Female" & !is.na(cancer_rates_melt$Rate),]

# Assigning colours to sites
f_q3_cols <- c("Colon and Rectum" = "#999999", "Liver‡" = "#56B4E9", "Lung and Bronchus" = "#009E73", "Pancreas‡" = "#F0E442", "Uterus†" = "#000000", "Stomach" = "#D55E00", "Breast" = "#CC79A7")

# Creating line graph for females
q3_p2 <- gf_smooth(Rate ~ Year, data = females_q3_2, color = ~Site, na.rm=TRUE) + 
            ylim(c(0, 90)) + 
            labs(title="Figure 3. Age-adjusted Cancer Death Rates by Site", 
                 subtitle = "Females, US, 1930-2014",
                 y = "Rate per 100,000 female population") +   
            scale_colour_manual(values = f_q3_cols)

# Aligning graphs side-by-side
library(gridExtra)
grid.arrange(arrangeGrob(q3_p1, q3_p2, nrow = 1, ncol = 2), heights=c(4,5))

# Note: Sorry, 'fig.height= ' won't scale the plots to an approrpiate size and I'm not sure how to avoid the big white space under the graphs with my current solution!

```


# Does breast-feeding weaken bones?

Yes, the data shows distinctly greater bone mineral loss among the breast-feeding women. From Table 1, we see that both measures of centre for breast-feeding women are negative and relatively large in magnitude, suggesting a substantially greater loss in the mineral content of the the spines of breast-feeding women compared to non-breastfeeding women. This is confirmed by the boxplot in Figure 4: there is no overlap in the spreads or medians of the boxes, indicating a distinct difference between the two groups.

<div style="margin-bottom:50px;">
</div>

```{r echo = FALSE, results = 'hide', message = FALSE}
## ---- Question-4 ------------------------------------------------------------

# Opening and examining dataset 
boneloss <- read.csv("https://github.com/sahirbhatnagar/EPIB607/raw/master/data/boneloss.csv")
head(boneloss)

```

```{r echo = FALSE, results = 'hide', message = FALSE}
## ---- Question-4 ------------------------------------------------------------

# Calculating descriptive statistics
bf <- boneloss[boneloss$type == "Breast-feeding",]
summary(bf)
sd(bf$mineral_loss, na.rm = FALSE)

other <- boneloss[boneloss$type == "Other",]
summary(other)
sd(other$mineral_loss, na.rm = FALSE)

# Creating a matrix of descriptive statistics
bf_ds <- c(-3.59, 2.51, -8.3, -5.3, -3.8, -2.1, 2.2)
other_ds <- c(0.31, 1.30, -2.2, -0.4, -0.05, 1.08, 2.9)

colnames <- c("Breastfeeding", "Non-breastfeeding")
rownames <- c("Mean", "SD", "Minimum", "Q1", "Median", "Q3", "Max")

boneless2 <- array(c(bf_ds,other_ds), dim = c(7,2), dimnames = list(rownames, colnames))

```

```{r echo = FALSE, message = FALSE}
# Formatting matrix into table
library(kableExtra)

kable(boneless2, caption = "Table 1. Descriptive statistics of percent change in the mineral content of the women’s spines over three months") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE) 

```
<div style="margin-bottom:50px;">
</div>
```{r echo = FALSE, message = FALSE, fig.width=6.5, fig.height=5}
## ---- Question-4 ------------------------------------------------------------

# Creating a boxplot
ggplot(boneloss, aes(factor(type), mineral_loss)) + 
  geom_boxplot(aes(fill = factor(type))) +
  ggtitle("Figure 4. Bone mineral loss distribution of breastfeeding \nand non-breastfeeding women ") +
  labs(x="Breastfeeding status",y="Bone mineral loss (%)") +
  scale_x_discrete(labels=c("Breastfeeding", "Non-breastfeeding")) +
  theme(legend.position="none") 
```

# Food in America

__BEST GRAPHIC: #[9](https://cdn0.vox-cdn.com/assets/4565307/farmers_old.gif)__

I have named #9 the best graphic because the scales used convey the information very clearly. The authors employed a good use of **position**, showing clear state and county divisions, as well as using **area** by providing a scale. This helps readers to easily distinguish and compare the average age of principal farm operators between different geographic locations in the US with the information to compare their respective sizes if desired. The selection of **colour** is also intuitive and unambiguous. The legend has distinct data bins and clear labels to convey that lighter colours indicate a younger average age, and darker colours indicate an olde average age. The colour gradation is also dramatic enough to avoid ambiguity in interpretation.

<div style="margin-bottom:50px;">
</div>

__WORST GRAPHIC: #[29](https://cdn0.vox-cdn.com/assets/4565605/waffle_house_height.jpg)__

Graoh #29 is the worst graphic because the design choices made by the creators have made it difficult for readers to extract information or understand the data included in the graphic. The use of 3D visualization is not constructive for the purposes of this graph; it does not seem to serve a purpose, and in fact, the tallest bar actually *covers* other data points on the graphic. Using a colour gradient to convey density of Waffle Houses may have been a better alternative. The use of **shape** was poor: ‘quad’, the units represented on the graph by rectangles are not easily understood by general public, and there are also no notes to inform the readers how the height of the rectangles convey density. It was also difficult to precisely discern the geographic **position** of the data points on the map due to the curvature of the globe (which also cut off certain parts of the US from the graphic) and unclear state lines. Last but not least, the decorative background that illustrates the terrain and ocean is distracting, with the colour containing information irrelevant to the graph.

<div style="margin-bottom:50px;">
</div>

# Code {-}

```{r all-code, ref.label=knitr::all_labels(), echo = TRUE, eval = FALSE}

```